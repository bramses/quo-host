'''
for 

{
    "id": "e1e8bf3f-3994-4d05-ad97-86dd9013cdd1",
    "created_at": "2024-04-03T23:28:54.529943",
    "quotes_shown": [
        277555459,
        41701665,
        530353150,
        624838178,
        57719718,
        241373572,
        247843039,
        230889111,
        668494368,
        549479788,
        41699568,
        41702250,
        277555447,
        230888891,
        41701667,
        689602790,
        471001922,
        504808405,
        562640029,
        145585455
    ],
    "what_happened": [
        {
            "id": "5a3bf1e9-a12b-4912-bc24-e3850116cdd8",
            "steps": [
                {
                    "name": "transcribe",
                    "data": "With issue 52, we are officially marking the one year anniversary of the newsletter. Anniversaries give us a great excuse to pause and reflect on the what and why of the work completed and the lessons that were learned. In issue 52, I'd like to go over what I have learned from shipping a weekly newsletter, reveal some metadata, and go over if maintaining a weekly newsletter was worth it. Why? The first question that should be answered about any decision is why?",
                    "timestamp": "2024-04-03T23:28:54.530720"
                },
                {
                    "name": "search",
                    "data": [
                        {
                            "text": "I\u2019d write a chapter or a section of my book, post it as a blog post, send out the same thing as a newsletter, and then read it aloud \u2014 plus a little extra commentary \u2014 as a podcast episode. The most important thing I learned was consistency. Thank goodness that tools exist to make this easy. I went away for a vacation, and we did a digital detox with no phones or computers. So, the week before, I spent a few hours queuing up all the stuff I wanted to send out while I was away, and it all happened without me.[35]",
                            "title": "Write Useful Books: A modern approach to designing and refining recommendable nonfiction",
                            "similarity": 0.82170289621887,
                            "id": 277555459,
                            "author": "Rob Fitzpatrick und Adam  Rosen",
                            "thoughts": null
                        },
                        {
                            "text": "I said earlier that I\u2019d decided to use this project to test my theory about what Linus Torvalds had done right. How (you may well ask) did I do that? In these ways: I released early and often (almost never less often than every ten days; during periods of intense development, once a day). I grew my beta list by adding to it everyone who contacted me about fetchmail. I sent chatty announcements to the beta list whenever I released, encouraging people to participate. And I listened to my beta-testers, polling them about design decisions and stroking them whenever they sent in patches and feedback.",
                            "title": "The Cathedral & the Bazaar: Musings on Linux and Open Source by an Accidental Revolutionary",
                            "similarity": 0.8041140347761,
                            "id": 314684635,
                            "author": "Eric S. Raymond",
                            "thoughts": null
                        },
                        {
                            "text": "I know people who run multimillion-dollar businesses off of their mailing lists. The model is very simple: They give away great stuff on their sites, they collect emails, and then when they have something remarkable to share or sell, they send an email. You\u2019d be amazed at how well the model works.",
                            "title": "Show Your Work!: 10 Ways to Share Your Creativity and Get Discovered",
                            "similarity": 0.798800963300898,
                            "id": 57719718,
                            "author": "Austin Kleon",
                            "thoughts": null
                        }
                    ],
                    "timestamp": "2024-04-03T23:28:57.433887"
                },
                {
                    "name": "filter",
                    "data": [
                        {
                            "text": "I\u2019d write a chapter or a section of my book, post it as a blog post, send out the same thing as a newsletter, and then read it aloud \u2014 plus a little extra commentary \u2014 as a podcast episode. The most important thing I learned was consistency. Thank goodness that tools exist to make this easy. I went away for a vacation, and we did a digital detox with no phones or computers. So, the week before, I spent a few hours queuing up all the stuff I wanted to send out while I was away, and it all happened without me.[35]",
                            "title": "Write Useful Books: A modern approach to designing and refining recommendable nonfiction",
                            "similarity": 0.82170289621887,
                            "id": 277555459,
                            "author": "Rob Fitzpatrick und Adam  Rosen",
                            "thoughts": null
                        },
                        {
                            "text": "I said earlier that I\u2019d decided to use this project to test my theory about what Linus Torvalds had done right. How (you may well ask) did I do that? In these ways: I released early and often (almost never less often than every ten days; during periods of intense development, once a day). I grew my beta list by adding to it everyone who contacted me about fetchmail. I sent chatty announcements to the beta list whenever I released, encouraging people to participate. And I listened to my beta-testers, polling them about design decisions and stroking them whenever they sent in patches and feedback.",
                            "title": "The Cathedral & the Bazaar: Musings on Linux and Open Source by an Accidental Revolutionary",
                            "similarity": 0.8041140347761,
                            "id": 314684635,
                            "author": "Eric S. Raymond",
                            "thoughts": null
                        },
                        {
                            "text": "I know people who run multimillion-dollar businesses off of their mailing lists. The model is very simple: They give away great stuff on their sites, they collect emails, and then when they have something remarkable to share or sell, they send an email. You\u2019d be amazed at how well the model works.",
                            "title": "Show Your Work!: 10 Ways to Share Your Creativity and Get Discovered",
                            "similarity": 0.798800963300898,
                            "id": 57719718,
                            "author": "Austin Kleon",
                            "thoughts": null
                        }
                    ],
                    "timestamp": "2024-04-03T23:28:57.433906"
                },
                {
                    "name": "select",
                    "data": {
                        "index": 0,
                        "reasoning": "The quote from 'Write Useful Books' perfectly aligns with the discussion on consistency and leveraging various formats to maintain and distribute content, as highlighted by the phrases 'consistency' and 'tools exist to make this easy.' These themes are directly relevant to the experience of running a weekly newsletter discussed in the transcription."
                    },
                    "timestamp": "2024-04-03T23:29:01.268660"
                },
                {
                    "name": "bold",
                    "data": "I\u2019d write a chapter or a section of my book, post it as a blog post, send out the same thing as a newsletter, and then read it aloud \u2014 plus a little extra commentary \u2014 as a podcast episode. **The most important thing I learned was consistency.** Thank goodness that **tools exist to make this easy.** I went away for a vacation, and we did a digital detox with no phones or computers. So, the week before, I spent a few hours queuing up all the stuff I wanted to send out while I was away, and it all happened without me.[35]",
                    "timestamp": "2024-04-03T23:29:06.253565"
                }
            ],
            "timestamp": "2024-04-03T23:28:54.530711"
        }
        ...

1. Extract the quotes_shown
2. For each quote in quote_shown, extract the text, title, author, and id
3. For each object, check if title is a key in covers.json
4. If it is, skip
5. If it is not, add the title as a key to covers.json and set the value to an empty string
'''

import json
from collections import defaultdict

LOG_FILE = './transcriber/logs/log-5a3fc4e9-c86c-4fdb-9058-c51bfbc60742.json'

with open('./transcriber/covers.json', 'r') as f:
    covers = json.load(f)

with open(LOG_FILE, 'r') as f:
    logs = json.load(f)

new_covers = defaultdict(str)

for quote in logs['quotes_shown']:
    print(f'Processing quote: {quote}')
    for events in logs['what_happened']:
        for step in events['steps']:
            if step['name'] == 'search':
                for search in step['data']:
                    if search['id'] == quote:
                        title = search['title']
                        if title in covers:
                            continue
                        else:
                            print(f'Adding {title} to new_covers')
                            new_covers[title] = ''

# append new_covers to covers
covers.update(new_covers)

# write covers to covers.json
with open('./transcriber/covers.json', 'w') as f:
    json.dump(covers, f, indent=4)

print('Done')
